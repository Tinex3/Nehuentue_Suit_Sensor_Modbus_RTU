#ifndef WEB_SERVER_H
#define WEB_SERVER_H

#include <Arduino.h>
#include <WiFi.h>
#include <ESPAsyncWebServer.h>
#include <ArduinoJson.h>
#include "tasks.h"

// Configuraci√≥n del servidor web
#define WEB_SERVER_PORT 80
#define AP_SSID_PREFIX "Modbus-Config-"
#define AP_PASSWORD "modbus2024"

// Estado del servidor web
enum WebServerMode {
    WEB_MODE_NONE,
    WEB_MODE_AP,     // Access Point mode
    WEB_MODE_STA     // Station mode (conectado a WiFi)
};

// Variables globales del servidor web
extern AsyncWebServer webServer;
extern WebServerMode currentWebMode;

// Funciones principales
void initWebServer();
void startAPMode();
void startSTAMode();
void stopWebServer();

// Handlers de endpoints
void handleRoot(AsyncWebServerRequest *request);
void handleStatus(AsyncWebServerRequest *request);
void handleConfig(AsyncWebServerRequest *request);
void handleConfigPost(AsyncWebServerRequest *request, uint8_t *data, size_t len, size_t index, size_t total);
void handleWiFiScan(AsyncWebServerRequest *request);
void handleRestart(AsyncWebServerRequest *request);
void handleSensorConfig(AsyncWebServerRequest *request, uint8_t *data, size_t len, size_t index, size_t total);

// Utilidades
String getAPSSID();
String getSystemStatusJSON();
String getConfigJSON();

#endif // WEB_SERVER_H
